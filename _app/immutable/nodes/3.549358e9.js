var $t=Object.defineProperty;var Nt=(a,t,e)=>t in a?$t(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var Y=(a,t,e)=>(Nt(a,typeof t!="symbol"?t+"":t,e),e);import{s as at,f as m,g,h as I,d as _,j as u,i as gt,B as xt,C as Et,y as X,D as E,E as At,F as Gt,a as B,l as U,c as k,m as W,A as Pt,x as c,G as Q,n as Bt,H as kt}from"../chunks/scheduler.3c5106a1.js";import{S as st,i as it,a as F,t as O,b as yt,d as _t,m as wt,e as vt}from"../chunks/index.54da3a63.js";function Mt(a){const t=a.getDimensions(),e=new Uint8ClampedArray(Array(t.height).fill(null).flatMap((i,s)=>Array(t.width).fill(null).flatMap((r,o)=>{const l=a.getCell({x:o,y:s}),d=$=>Math.round($*255),h=d(l.red),A=d(l.green),y=d(l.blue);return[h,A,y,255]})));return new ImageData(e,t.width,t.height)}function nt(a,t){const e=a.getContext("2d");e!==null&&e.putImageData(t,0,0)}function Ht(a){let t,e,n,i,s,r;return{c(){t=m("canvas"),this.h()},l(o){t=g(o,"CANVAS",{class:!0,height:!0,width:!0}),I(t).forEach(_),this.h()},h(){u(t,"class","camera-canvas svelte-v2hpbb"),u(t,"height",e=a[0].getDimensions().height),u(t,"width",n=a[0].getDimensions().width)},m(o,l){gt(o,t,l),s||(r=xt(i=a[2].call(null,t,a[1])),s=!0)},p(o,[l]){l&1&&e!==(e=o[0].getDimensions().height)&&u(t,"height",e),l&1&&n!==(n=o[0].getDimensions().width)&&u(t,"width",n),i&&Et(i.update)&&l&2&&i.update.call(null,o[1])},i:X,o:X,d(o){o&&_(t),s=!1,r()}}}function Lt(a,t,e){let n,{drawnRays:i}=t;const s=(r,o)=>(nt(r,o),{update:l=>{nt(r,l)}});return a.$$set=r=>{"drawnRays"in r&&e(0,i=r.drawnRays)},a.$$.update=()=>{a.$$.dirty&1&&e(1,n=Mt(i))},[i,n,s]}class Ut extends st{constructor(t){super(),it(this,t,Lt,Ht,at,{drawnRays:0})}}function Wt(a){let t,e,n,i,s,r;return{c(){t=m("canvas"),this.h()},l(o){t=g(o,"CANVAS",{class:!0,height:!0,width:!0}),I(t).forEach(_),this.h()},h(){u(t,"class","scene-canvas svelte-urc5cm"),u(t,"height",e=a[0].getDimensions().height),u(t,"width",n=a[0].getDimensions().width)},m(o,l){gt(o,t,l),s||(r=[E(t,"click",a[2]),xt(i=a[3].call(null,t,a[1]))],s=!0)},p(o,[l]){l&1&&e!==(e=o[0].getDimensions().height)&&u(t,"height",e),l&1&&n!==(n=o[0].getDimensions().width)&&u(t,"width",n),i&&Et(i.update)&&l&2&&i.update.call(null,o[1])},i:X,o:X,d(o){o&&_(t),s=!1,At(r)}}}function Yt(a,t,e){let n;const i=Gt();let{drawnScene:s}=t;const r=l=>{const d={x:l.offsetX,y:l.offsetY};i("click",d)},o=(l,d)=>(nt(l,d),{update:h=>{nt(l,h)}});return a.$$set=l=>{"drawnScene"in l&&e(0,s=l.drawnScene)},a.$$.update=()=>{a.$$.dirty&1&&e(1,n=Mt(s))},[s,n,r,o]}class Xt extends st{constructor(t){super(),it(this,t,Yt,Wt,at,{drawnScene:0})}}function Ft(a){const t=(a%1+1)%1,e=t<1/6?1:t<2/6?1-(t-1/6)/(1/6):t<4/6?0:t<5/6?(t-4/6)/(1/6):1,n=t<1/6?t/(1/6):t<3/6?1:t<4/6?1-(t-3/6)/(1/6):0;return{blue:t<2/6?0:t<3/6?t/(1/6):t<5/6?1:t<6/6?1-(t-5/6)/(1/6):0,green:n,red:e}}function Ot(a,t){const e=a.x-t.x,n=a.y-t.y;return Math.sqrt(e*e+n*n)}function qt(a,t){return Ot(a,t.center)<=t.radius}function Tt(a,t,e){const n={x:Math.round(t.center.x-t.radius),y:Math.round(t.center.y-t.radius)},i={x:Math.round(t.center.x+t.radius),y:Math.round(t.center.y+t.radius)};for(let s=n.y;s<=i.y;++s)for(let r=n.x;r<=i.x;++r){const o={x:r,y:s};if(qt(o,t)){const l=e(o);try{a.putCell(o,l)}catch{}}}}class zt{constructor(t){Y(this,"rays");Y(this,"wallBoard");this.wallBoard=t,this.rays=[]}addWall(t){const e=n=>{const i=(n.x+n.y)/150;return Ft(i)};Tt(this.wallBoard,t,e)}getDimensions(){return this.wallBoard.getDimensions()}getHitAtPosition(t){const e={x:Math.round(t.x),y:Math.round(t.y)};return(()=>{try{return this.wallBoard.getCell(e)}catch{return null}})()}getRays(){return this.rays}getWall(t){return this.wallBoard.getCell(t)}resetRays(t,e){const n=Array(t).fill(null).map((i,s)=>{const r=s/(t-1),o={x:Math.tan(e*(r-.5)),y:-1},l={x:this.wallBoard.getDimensions().width/2,y:this.wallBoard.getDimensions().height},d=0;return{delta:o,hit:this.getHitAtPosition(l),position:l,ticksPassed:d}});this.rays=n}tick(t,e){for(let n=0;n<e;++n)this.rays=this.rays.map(i=>this.tickRay(i,t))}tickRay(t,e){if(t.hit!==null)return t;const n={x:t.position.x+t.delta.x*e,y:t.position.y+t.delta.y*e},i=this.getHitAtPosition(n);return{delta:t.delta,hit:i,position:n,ticksPassed:t.ticksPassed+e}}}const Vt={blue:0,green:0,red:0};class bt{constructor(t,e){Y(this,"cells");Y(this,"dimensions");this.dimensions=t,this.cells=Array(t.height).fill(null).map(()=>Array(t.width).fill(e))}getCell(t){const e=this.cells[t.y];if(e===void 0)throw new Error("Invalid row.");const n=e[t.x];if(n===void 0)throw new Error("Invalid column.");return n}getDimensions(){return this.dimensions}putCell(t,e){const n=this.cells[t.y];if(n===void 0)throw new Error("Invalid row.");n[t.x]=e}}function Z(a){const t=a.getDimensions(),e=new bt(t,Vt);for(let n=0;n<t.height;++n)for(let i=0;i<t.width;++i){const s={x:i,y:n},r=a.getWall(s);r!==null&&e.putCell(s,r)}for(const n of a.getRays())Tt(e,{center:n.position,radius:1},()=>({blue:1,green:1,red:1}));return e}function tt(a,t,e,n){const i=new bt({height:t,width:a.length},Vt);for(const[s,r]of a.entries()){if(r.hit===null)continue;const o=n/r.ticksPassed*Math.cos(e/2)/(300/t),l=Math.round((t-o)/2),d=Math.round(t-(t-o)/2);for(let h=l;h<=d;++h)try{i.putCell({x:s,y:h},r.hit)}catch{}}return i}function jt(a){let t,e;return t=new Xt({props:{drawnScene:a[2]}}),t.$on("click",a[6]),{c(){yt(t.$$.fragment)},l(n){_t(t.$$.fragment,n)},m(n,i){wt(t,n,i),e=!0},p(n,i){const s={};i&4&&(s.drawnScene=n[2]),t.$set(s)},i(n){e||(F(t.$$.fragment,n),e=!0)},o(n){O(t.$$.fragment,n),e=!1},d(n){vt(t,n)}}}function Jt(a){let t,e;return t=new Ut({props:{drawnRays:a[4]}}),{c(){yt(t.$$.fragment)},l(n){_t(t.$$.fragment,n)},m(n,i){wt(t,n,i),e=!0},p(n,i){const s={};i&16&&(s.drawnRays=n[4]),t.$set(s)},i(n){e||(F(t.$$.fragment,n),e=!0)},o(n){O(t.$$.fragment,n),e=!1},d(n){vt(t,n)}}}function Kt(a){let t,e,n,i,s,r,o,l,d,h,A,y,V,v,$="Reset",N,S,R,G,M,lt,b,rt,T,H,ot,q,ct,w,z,ut,dt,ht,L,Ct='Go to <a href="/what-is-next">What is Next?</a>.',x,ft,Dt,C=jt(a),D=Jt(a);return{c(){t=m("div"),e=m("div"),C&&C.c(),n=B(),D&&D.c(),i=B(),s=m("div"),r=m("button"),o=U("Start"),d=B(),h=m("button"),A=U("Stop"),V=B(),v=m("button"),v.textContent=$,N=B(),S=m("label"),R=m("span"),G=U("Simulation speed multiplier: "),M=U(a[1]),lt=B(),b=m("input"),rt=B(),T=m("label"),H=m("span"),ot=U("Ray count: "),q=U(a[0]),ct=B(),w=m("input"),ut=B(),dt=m("br"),ht=B(),L=m("div"),L.innerHTML=Ct,this.h()},l(p){t=g(p,"DIV",{class:!0});var f=I(t);e=g(f,"DIV",{class:!0});var j=I(e);C&&C.l(j),n=k(j),D&&D.l(j),j.forEach(_),i=k(f),s=g(f,"DIV",{});var P=I(s);r=g(P,"BUTTON",{type:!0});var It=I(r);o=W(It,"Start"),It.forEach(_),d=k(P),h=g(P,"BUTTON",{type:!0});var Rt=I(h);A=W(Rt,"Stop"),Rt.forEach(_),V=k(P),v=g(P,"BUTTON",{type:!0,"data-svelte-h":!0}),Pt(v)!=="svelte-1rifug5"&&(v.textContent=$),N=k(P),S=g(P,"LABEL",{});var J=I(S);R=g(J,"SPAN",{});var pt=I(R);G=W(pt,"Simulation speed multiplier: "),M=W(pt,a[1]),pt.forEach(_),lt=k(J),b=g(J,"INPUT",{max:!0,min:!0,step:!0,type:!0}),J.forEach(_),rt=k(P),T=g(P,"LABEL",{});var K=I(T);H=g(K,"SPAN",{});var mt=I(H);ot=W(mt,"Ray count: "),q=W(mt,a[0]),mt.forEach(_),ct=k(K),w=g(K,"INPUT",{max:!0,min:!0,step:!0,type:!0}),K.forEach(_),P.forEach(_),ut=k(f),dt=g(f,"BR",{}),ht=k(f),L=g(f,"DIV",{"data-svelte-h":!0}),Pt(L)!=="svelte-6rtnbv"&&(L.innerHTML=Ct),f.forEach(_),this.h()},h(){u(e,"class","raycasting-example__displays svelte-1lipota"),r.disabled=l=a[3]!==null,u(r,"type","button"),h.disabled=y=a[3]===null,u(h,"type","button"),u(v,"type","button"),u(b,"max","80"),u(b,"min","0"),u(b,"step","1"),u(b,"type","range"),w.disabled=z=a[3]!==null,u(w,"max",a[5].getDimensions().width),u(w,"min","2"),u(w,"step","1"),u(w,"type","range"),u(t,"class","raycasting-example svelte-1lipota")},m(p,f){gt(p,t,f),c(t,e),C&&C.m(e,null),c(e,n),D&&D.m(e,null),c(t,i),c(t,s),c(s,r),c(r,o),c(s,d),c(s,h),c(h,A),c(s,V),c(s,v),c(s,N),c(s,S),c(S,R),c(R,G),c(R,M),c(S,lt),c(S,b),Q(b,a[1]),c(s,rt),c(s,T),c(T,H),c(H,ot),c(H,q),c(T,ct),c(T,w),Q(w,a[0]),c(t,ut),c(t,dt),c(t,ht),c(t,L),x=!0,ft||(Dt=[E(r,"click",a[7]),E(h,"click",a[8]),E(v,"click",a[9]),E(b,"change",a[10]),E(b,"input",a[10]),E(w,"change",a[11]),E(w,"input",a[11])],ft=!0)},p(p,[f]){C.p(p,f),D.p(p,f),(!x||f&8&&l!==(l=p[3]!==null))&&(r.disabled=l),(!x||f&8&&y!==(y=p[3]===null))&&(h.disabled=y),(!x||f&2)&&Bt(M,p[1]),f&2&&Q(b,p[1]),(!x||f&1)&&Bt(q,p[0]),(!x||f&8&&z!==(z=p[3]!==null))&&(w.disabled=z),f&1&&Q(w,p[0])},i(p){x||(F(C),F(D),x=!0)},o(p){O(C),O(D),x=!1},d(p){p&&_(t),C&&C.d(),D&&D.d(),ft=!1,At(Dt)}}}const et=8e3,St=.1;function Qt(a,t,e){let n,i=1,s=300;const r=Math.PI/2,o=Math.PI/2,l=(()=>{const R={height:300,width:300},G=new bt(R,null);return new zt(G)})();let d=Z(l);const h=R=>{const M={center:R.detail,radius:10};l.addWall(M),e(2,d=Z(l)),e(4,n=tt(l.getRays(),s,r,et))},A=()=>{l.tick(St,i),e(2,d=Z(l)),e(4,n=tt(l.getRays(),s,r,et))};let y=null;const V=()=>{y!==null&&clearInterval(y),e(3,y=setInterval(A,St*1e3))},v=()=>{y!==null&&(clearInterval(y),e(3,y=null))},$=()=>{l.resetRays(s,o),e(2,d=Z(l)),e(4,n=tt(l.getRays(),s,r,et))};function N(){i=kt(this.value),e(1,i)}function S(){s=kt(this.value),e(0,s)}return a.$$.update=()=>{a.$$.dirty&1&&l.resetRays(s,Math.PI/2),a.$$.dirty&1&&e(4,n=tt(l.getRays(),s,r,et))},[s,i,d,y,n,l,h,V,v,$,N,S]}class Zt extends st{constructor(t){super(),it(this,t,Qt,Kt,at,{})}}function te(a){let t,e;return t=new Zt({}),{c(){yt(t.$$.fragment)},l(n){_t(t.$$.fragment,n)},m(n,i){wt(t,n,i),e=!0},p:X,i(n){e||(F(t.$$.fragment,n),e=!0)},o(n){O(t.$$.fragment,n),e=!1},d(n){vt(t,n)}}}class se extends st{constructor(t){super(),it(this,t,null,te,at,{})}}export{se as component};
